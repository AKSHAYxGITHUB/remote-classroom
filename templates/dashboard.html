{% extends "layout.html" %}

{% block title %}Dashboard - Rajasthan Digi-Shala{% endblock %}

{% block extra_css %}
<style>
    .dashboard-header {
        background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
        color: white;
        padding: 2rem;
        border-radius: 16px;
        margin-bottom: 2rem;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    
    .course-card {
        border-left: 4px solid #4F46E5;
        transition: all 0.3s ease;
    }
    
    .course-card:hover {
        border-left-color: #F59E0B;
        transform: translateX(5px);
    }
    
    .attendance-bar {
        width: 100%;
        height: 6px;
        background: #E5E7EB;
        border-radius: 3px;
        overflow: hidden;
        margin: 0.5rem 0;
    }
    
    .attendance-fill {
        height: 100%;
        background: linear-gradient(90deg, #10B981, #059669);
        border-radius: 3px;
        transition: width 0.5s ease;
    }
    
    .course-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
        flex-wrap: wrap;
    }
    
    .quick-action {
        background: #F8FAFC;
        border: 1px solid #E2E8F0;
        border-radius: 8px;
        padding: 0.5rem 1rem;
        color: #4F46E5;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .quick-action:hover {
        background: #4F46E5;
        color: white;
        transform: translateY(-1px);
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1 style="font-size: 2.2rem; font-weight: 700; margin-bottom: 0.5rem;">
        {% if current_user.role == 'teacher' %}
            <i class="fas fa-chalkboard-teacher"></i> Teacher Dashboard
        {% else %}
            <i class="fas fa-user-graduate"></i> Student Dashboard
        {% endif %}
    </h1>
    <p style="font-size: 1.1rem; opacity: 0.9;">
        Welcome back, {{ current_user.username }}! Ready to continue your journey?
    </p>
</div>

{% if current_user.role == 'teacher' %}
<div class="stats-grid">
    <div class="stat-card">
        <i class="fas fa-book" style="font-size: 2rem; color: #4F46E5; margin-bottom: 0.5rem;"></i>
        <h3 style="font-size: 1.5rem; font-weight: 600; color: #374151;">{{ courses|length }}</h3>
        <p style="color: #6B7280; font-size: 0.9rem;">Courses Teaching</p>
    </div>
    <div class="stat-card">
        <i class="fas fa-users" style="font-size: 2rem; color: #F59E0B; margin-bottom: 0.5rem;"></i>
        <h3 style="font-size: 1.5rem; font-weight: 600; color: #374151;">
            {{ courses|sum(attribute='enrolled_count') }}
        </h3>
        <p style="color: #6B7280; font-size: 0.9rem;">Total Students</p>
    </div>
    <div class="stat-card">
        <i class="fas fa-calendar-check" style="font-size: 2rem; color: #10B981; margin-bottom: 0.5rem;"></i>
        <h3 style="font-size: 1.5rem; font-weight: 600; color: #374151;">Active</h3>
        <p style="color: #6B7280; font-size: 0.9rem;">Status</p>
    </div>
</div>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2 style="color: #374151; font-weight: 600; font-size: 1.5rem;">
            <i class="fas fa-chalkboard"></i> My Courses
        </h2>
        <button onclick="showCreateCourseModal()" class="btn btn-secondary">
            <i class="fas fa-plus"></i> Create New Course
        </button>
    </div>
    
    {% if courses %}
        <div class="grid grid-2">
            {% for course in courses %}
            <div class="card course-card">
                <h3 style="color: #374151; font-weight: 600; margin-bottom: 0.5rem;">{{ course.title }}</h3>
                <p style="color: #6B7280; font-size: 0.9rem; margin-bottom: 1rem;">{{ course.description }}</p>
                
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                    <span style="background: #DBEAFE; color: #1E40AF; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">
                        <i class="fas fa-users"></i> {{ course.enrolled_count }} students
                    </span>
                </div>
                
                <div class="course-actions">
                    <a href="{{ url_for('course', course_id=course.id) }}" class="quick-action">
                        <i class="fas fa-eye"></i> View Course
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 3rem; color: #6B7280;">
            <i class="fas fa-chalkboard" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;"></i>
            <h3 style="margin-bottom: 1rem;">No courses yet</h3>
            <p style="margin-bottom: 2rem;">Create your first course and start teaching!</p>
            <button onclick="showCreateCourseModal()" class="btn btn-primary">
                <i class="fas fa-plus"></i> Create Your First Course
            </button>
        </div>
    {% endif %}
</div>

{% else %}
<div class="stats-grid">
    <div class="stat-card">
        <i class="fas fa-book-open" style="font-size: 2rem; color: #4F46E5; margin-bottom: 0.5rem;"></i>
        <h3 style="font-size: 1.5rem; font-weight: 600; color: #374151;">{{ courses|length }}</h3>
        <p style="color: #6B7280; font-size: 0.9rem;">Enrolled Courses</p>
    </div>
    <div class="stat-card">
        <i class="fas fa-percentage" style="font-size: 2rem; color: #10B981; margin-bottom: 0.5rem;"></i>
        <h3 style="font-size: 1.5rem; font-weight: 600; color: #374151;">
            {% set total_attendance = courses|sum(attribute='total_attendance') %}
            {% set present_count = courses|sum(attribute='present_count') %}
            {{ (present_count * 100 / total_attendance)|round|int if total_attendance > 0 else 0 }}%
        </h3>
        <p style="color: #6B7280; font-size: 0.9rem;">Avg Attendance</p>
    </div>
    <div class="stat-card">
        <i class="fas fa-trophy" style="font-size: 2rem; color: #F59E0B; margin-bottom: 0.5rem;"></i>
        <h3 style="font-size: 1.5rem; font-weight: 600; color: #374151;">Good</h3>
        <p style="color: #6B7280; font-size: 0.9rem;">Performance</p>
    </div>
</div>

<div class="card">
    <h2 style="color: #374151; font-weight: 600; font-size: 1.5rem; margin-bottom: 2rem;">
        <i class="fas fa-graduation-cap"></i> My Courses
    </h2>
    
    {% if courses %}
        <div class="grid grid-2">
            {% for course in courses %}
            <div class="card course-card">
                <h3 style="color: #374151; font-weight: 600; margin-bottom: 0.5rem;">{{ course.title }}</h3>
                <p style="color: #6B7280; font-size: 0.9rem; margin-bottom: 1rem;">{{ course.description }}</p>
                
                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-size: 0.9rem; color: #374151;">Attendance</span>
                        <span style="font-size: 0.9rem; color: #374151; font-weight: 600;">
                            {{ (course.present_count * 100 / course.total_attendance)|round|int if course.total_attendance > 0 else 0 }}%
                        </span>
                    </div>
                    <div class="attendance-bar">
                        <div class="attendance-fill" style="width: {{ (course.present_count * 100 / course.total_attendance)|round|int if course.total_attendance > 0 else 0 }}%;"></div>
                    </div>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <span style="background: #FEF3C7; color: #92400E; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">
                        <i class="fas fa-user-tie"></i> {{ course.teacher_name }}
                    </span>
                </div>
                
                <div class="course-actions">
                    <a href="{{ url_for('course', course_id=course.id) }}" class="quick-action">
                        <i class="fas fa-eye"></i> View Course
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 3rem; color: #6B7280;">
            <i class="fas fa-book-open" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;"></i>
            <h3 style="margin-bottom: 1rem;">No enrolled courses</h3>
            <p style="margin-bottom: 2rem;">Start your learning journey by enrolling in courses!</p>
        </div>
    {% endif %}
</div>

<div class="card">
    <h2 style="color: #374151; font-weight: 600; font-size: 1.5rem; margin-bottom: 2rem;">
        <i class="fas fa-search-plus"></i> Available Courses to Enroll
    </h2>
    
    {% if available_courses %}
        <div class="grid grid-2">
            {% for course in available_courses %}
            <div class="card course-card">
                <h3 style="color: #374151; font-weight: 600; margin-bottom: 0.5rem;">{{ course.title }}</h3>
                <p style="color: #6B7280; font-size: 0.9rem; margin-bottom: 1rem;">{{ course.description }}</p>
                
                <div style="margin-bottom: 1rem;">
                    <span style="background: #FEF3C7; color: #92400E; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">
                        <i class="fas fa-user-tie"></i> {{ course.teacher_name }}
                    </span>
                </div>
                
                <div class="course-actions">
                    <a href="{{ url_for('enroll', course_id=course.id) }}" class="btn btn-secondary">
                        <i class="fas fa-plus-circle"></i> Enroll Now
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 3rem; color: #6B7280;">
            <i class="fas fa-check-circle" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;"></i>
            <h3 style="margin-bottom: 1rem;">You are enrolled in all available courses!</h3>
            <p>Check back later for new courses.</p>
        </div>
    {% endif %}
</div>
{% endif %}

{% if current_user.role == 'teacher' %}
<div id="createCourseModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
    <div style="background: white; padding: 2rem; border-radius: 16px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto;">
        <h3 style="color: #374151; font-weight: 600; margin-bottom: 1.5rem;">
            <i class="fas fa-plus"></i> Create New Course
        </h3>
        
        <form action="{{ url_for('create_course') }}" method="POST">
            <div class="form-group">
                <label for="title">Course Title</label>
                <input type="text" id="title" name="title" required>
            </div>
            
            <div class="form-group">
                <label for="description">Course Description</label>
                <textarea id="description" name="description" rows="4" required></textarea>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button type="button" onclick="hideCreateCourseModal()" class="btn btn-outline">
                    Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Create Course
                </button>
            </div>
        </form>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
function showCreateCourseModal() {
    document.getElementById('createCourseModal').style.display = 'flex';
}

function hideCreateCourseModal() {
    document.getElementById('createCourseModal').style.display = 'none';
}

// Close modal when clicking outside
document.getElementById('createCourseModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        hideCreateCourseModal();
    }
});
</script>
{% endblock %}